import { useEffect, useState } from 'react'; import { api } from '../../api/client'; import { Button } from '../../components/ui/Button'; import { Card, CardContent } from '../../components/ui/Card'; import { toast } from 'sonner'; import { Check, User, Loader2, DollarSign, Calendar } from 'lucide-react'; interface Payment { id: string; creator_id: string; creator_email: string; amount_usdt: number; tx_hash: string; status: string; created_at: string; } export default function PaymentReview() { const [payments, setPayments] = useState<Payment[]>([]); const [isLoading, setIsLoading] = useState(true); const [processingId, setProcessingId] = useState<string | null>(null); useEffect(() => { fetchPayments(); }, []); const fetchPayments = async () => { setIsLoading(true); try { const res = await api.get('/plans/payments?status=pending'); setPayments(res.data); } catch (error) { console.error(error); toast.error("Failed to load payments"); } finally { setIsLoading(false); } }; const handleConfirm = async (id: string) => { setProcessingId(id); try { await api.post(`/plans/payments/${id}/confirm`); toast.success(`Payment confirmed successfully`); setPayments(prev => prev.filter(p => p.id !== id)); } catch (error) { console.error(error); toast.error(`Failed to confirm payment`); } finally { setProcessingId(null); } }; if (isLoading) return <div className="flex justify-center py-12"><Loader2 className="animate-spin h-8 w-8 text-slate-600" /></div>; return ( <div className="space-y-6"> <h1 className="text-3xl font-bold text-slate-900">SaaS Payment Confirmations</h1> {payments.length === 0 ? ( <div className="text-center py-12 bg-white rounded-lg border border-dashed border-gray-300"> <p className="text-gray-500">No pending payments.</p> </div> ) : ( <div className="space-y-4"> {payments.map(payment => ( <Card key={payment.id}> <CardContent className="p-6"> <div className="flex flex-col md:flex-row items-center justify-between gap-6"> {/* Info */} <div className="flex-1 space-y-2"> <div className="flex items-center space-x-2"> <User className="h-4 w-4 text-gray-500" /> <span className="font-medium text-slate-900">{payment.creator_email}</span> </div> <div className="flex items-center space-x-2 text-sm text-gray-500"> <Calendar className="h-3 w-3" /> <span>{new Date(payment.created_at).toLocaleString()}</span> </div> </div> {/* Amount & TX */} <div className="flex-1 bg-gray-50 p-3 rounded border border-gray-200"> <div className="flex items-center justify-between mb-2"> <span className="text-xs text-gray-500 uppercase font-semibold">Amount</span> <div className="flex items-center font-bold text-emerald-600"> <DollarSign className="h-4 w-4" /> {payment.amount_usdt.toFixed(2)} </div> </div> <div className="text-xs break-all"> <span className="text-gray-500 font-semibold">TX: </span> <span className="font-mono text-gray-700">{payment.tx_hash}</span> </div> </div> {/* Action */} <div className="w-full md:w-auto"> <Button className="w-full bg-emerald-600 hover:bg-emerald-700" onClick={() => handleConfirm(payment.id)} disabled={!!processingId} > {processingId === payment.id ? <Loader2 className="animate-spin h-4 w-4" /> : <Check className="mr-2 h-4 w-4" />} Confirm Receipt </Button> </div> </div> </CardContent> </Card> ))} </div> )} </div> ); } 